# Stroke-Triage-Policy-Project
Our project continuing work in Winter 2024 for CS239 on the routing of stroke patients to nearest hospitals to optimize probability of a good patient outcome.

Notes:
- Any files beginning with xx (e.g., xxSTPMDP.jl) are outdated and no longer used. They are just still here for our reference.


An overview of the repo:\n
**Figures** is a directory where we store all figures and plots produced in our simulations.

**HospitalInfo** is a directory that stores CSV files for each region. Each CSV is a list of hospitals + relevant information about that hospital (e.g. lat/lon coordinates, hospital name, classification type of the hospital...)

**PatientPoints** is a directory that stores CSV files of approximately 5000 randomly sampled locations, by population density, masked to being on land (we have ond for CA, and one for RI). 

**PlottingFiles** is a directory containing files with functions that aid in generating plots:
- `grid_plot_RI.jl` produces a hotspot grid for the state of Rhode Island. NOTE: this should be eventually separated out into `grid_plot_data_RI.jl` and `grid_plot_graph_RI.jl`.
- `grid_plot_constants.jl` is a simple file containing constants used in `grid_plot_data_CA.jl` and `grid_plot_graph_CA.jl`.
- `grid_plot_data_CA.jl` grids up the bay area region of interest in CA into a grid of `GRID_WIDTHxGRID_WIDTH` tiles, samples `NUM_SAMPLES` patients in each of these tiles, and computes the average probability of a good outcome of all of the patients sampled from that tile (constants are specified in `grid_plot_constants.jl`). It stores this information in CSV files (one CSV file per tile) in the **grid_plot_csvs_CA** directory.
- `grid_plot_graph_CA.jl` uses the CSV information generated by `grid_plot_data_CA.jl` and stored in **grid_plot_csvs_CA** to produce the actual visual representation of probability of good outcome by tile region.
- `map_plot_CA.jl` and `map_plot_RI.jl` are no longer being used in our paper, but can be used to produce a simple image of the Bay Area/Rhode Island with a specified number of sample patients scattered over the region, with the color of the point representing the patient's probability of good outcome.

**SimResults** is a directory that contains a variety of simulation results (probability of good outcome under our policy, probability of a good outcome under the state's current status quo policy, starting state lat/lon coords)

`STPMDP_ORS.jl` contains the implementation of the MDP. This is the main file of interest. It uses ORS to compute travel times, and therefore provides a more accurate estimation of the decision-making process than `STPMDP_original.jl` does, which simply used haversine distance as a proxy for travel time.

`action_enum.jl` is a file that is a somewhat hacky way of doing things, but since you can't define an enum at runtime this was the most effective way to do it convert a **HospitalInfo** CSV into the strings of the possible routing actions for this state/region that can then be pasted into the Action enum type in `STPMDP_ORS.jl`. Just feed in the filename of the CSV to hospital_file. It prints out to the console, line by line, what all the actions should be.

`construct_decision_tree.jl` is a file that produces a decision tree policy from a bunch of example routings from our policy (that comes from solving our MDP with forward search to a depth of 2).

`evaluate_policies.jl` compares our smarter policy with the baseline (CA's or RI's current policy) and some heuristic policies. 

`patient_generator.jl` simulates a single stroke patient scenario in California, generating a patient state and comparing the outcomes 
of an MDP-based optimal triage policy with the current state policy by analyzing recommended actions, rewards, and travel times. Good for testing purposes to generate a single patient and follow the full pipeline of routing the patient according to various policies.

`performance_metric_eval.jl` models stroke patient triage and transport using Markov Decision Processes (MDPs) in 
California. It simulates results across various different performance metrics to test validity of results in different settings.

`simulations_CA.jl` and `simulations_RI.jl` run many simulations of a random patient (with random field location, random stroke type), and produces the recommended actions to take (via our policy, and California's current policy). Uses `STPMDP_ORS.jl` to produce the MDP.
 
